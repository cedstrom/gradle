This feature is a bucket for improvements to core Gradle plugins. Most of these improvements are not strategic.

As this 'feature' is a list of bug fixes, this feature spec will not follow the usual template.

# Application plugin

## Allow custom templates for the start scripts

* [GRADLE-2299](https://issues.gradle.org/browse/GRADLE-2299) - Application plugin should allow custom templates for the start scripts
* [GRADLE-2207](https://issues.gradle.org/browse/GRADLE-2207) - Allow application plugin start scripts to be more flexible for different environments

### Use cases

* The user of the application plugin wants full flexibility and control over the scripts templates e.g. conditionals as part of the logic, using additional variables.
* Modifying the default scripts by proving additional logic.
* Generating additional start scripts for dedicated use cases in addition to the default batch and shell scripts.

### Implementation plan

#### Introduce new interface

Introduce a new public interface `org.gradle.api.scripting.ScriptGenerator`. This interface will allow for having different implementations of a script generator e.g one for Unix and one for Windows. The interface supports a single method:

    package org.gradle.api.scripting;

    import java.io.Writer;

    public interface ScriptGenerator<T extends ScriptGenerationDetails> {
        void generateScript(T details, Writer destination);
    }

The parameter with type `org.gradle.api.scripting.ScriptGenerationDetails` provides the parameters needed for generating the script, for example the classpath or the JVM parameters. `ScriptGenerationDetails` could start out as marker interface. The parameter `destination` determines the target output of the generator. Using the type `java.io.Writer` allows for more flexibility.

#### Change `StartScriptGenerator`

The existing `org.gradle.api.internal.plugins.StartScriptGenerator` implementation has to be broken up into two different classes:

* `org.gradle.api.internal.plugins.UnixStartScriptGenerator`: Generates Unix start script for application plugin.
* `org.gradle.api.internal.plugins.WindowsStartScriptGenerator`: Generates Windows start script for application plugin.

Both classes need to implement the new interface `org.gradle.api.scripting.ScriptGenerator`. Furthermore, the class needs to be serializable so it can be used as input property for tasks. The implementation of `ScriptGenerationDetails`, `org.gradle.api.internal.plugins.DefaultScriptGenerationDetails`, should contain all fields from `StartScriptGenerator`. Certain methods `StartScriptGenerator` are reusable and should be extracted as utility class.

#### Modify existing usage of `StartScriptGenerator`

There are various places across the Gradle codebase that use the class `StartScriptGenerator`. All of these places will need to use the new implementation.

#### Allow for setting the `ScriptGenerator` for task type `CreateStartScripts`

Currently, the task `org.gradle.api.tasks.application.CreateStartScripts` creates an instance of `StartScriptGenerator` in its action. To allow for users to set the `ScriptGenerator` from the outside, we will expose two properties: `unixStartScriptGenerator` and `windowsStartScriptGenerator`. Their default values are the respective default implementations. Both properties should be annotated with `@Input`.

### User visible changes

The existing functionality should work as usual. The main change to the user are the exposed properties of type `ScriptGenerator` in the custom task `CreateStartScripts`.

### Test coverage

* Break up `StartScriptGeneratorTest` into two classes: one for the Unix-based, one for the Windows-based implementation.
* Write an example implementation of `ScriptGenerator` and test it.
* `CreateStartScriptsTest` should work with the existing assertions.
* Add a test case that allows for setting custom implementations of `ScriptGenerator` to generate start scripts.
* `ApplicationPluginTest` should work with the existing assertions.
* Extend test cases of `ApplicationPluginTest`:
	* 	Verify that the task named `startScripts` can be reconfigured to use custom implementations `ScriptGenerator`.
	*  Allow for modifying the default generation of start scripts.

### Open issues

* The classes `UnixStartScriptGenerator` and `WindowsStartScriptGenerator` should probably become part of the public API so users can create composite implementations that modify the start script generated by the default implementations.
* In the proposed approach there's no way to add new start script generators.